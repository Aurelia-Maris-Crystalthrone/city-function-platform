<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå¸‚åŠŸèƒ½åŒºåŠ¨æ€åˆ†æå¹³å° - å¯è§†åŒ–åŸå‹</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet Extra CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            gap: 20px;
        }
        
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 24px;
        }
        
        .header .tagline {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .header .author {
            color: #3498db;
            font-weight: bold;
        }
        
        .content {
            display: flex;
            flex: 1;
            gap: 20px;
        }
        
        .left-panel {
            flex: 3;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .map-container {
            flex: 3;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .controls h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: 500;
        }
        
        select, input, button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .stats-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        
        .stats-panel h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        .stat-item {
            margin-bottom: 12px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .legend-panel {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            flex: 1;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .legend-label {
            font-size: 14px;
            color: #34495e;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #7f8c8d;
            font-size: 12px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .close-btn {
            float: right;
            cursor: pointer;
            font-size: 24px;
            color: #7f8c8d;
        }
        
        @media (max-width: 1024px) {
            .content {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                flex: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div>
                <h1>ğŸ™ï¸ åŸå¸‚åŠŸèƒ½åŒºåŠ¨æ€åˆ†æå¹³å°</h1>
                <div class="tagline">åŸºäºå¤šæºæ•°æ®èåˆçš„åŸå¸‚åŠŸèƒ½åŒºè¯†åˆ«ä¸å¯è§†åŒ–ç³»ç»Ÿ | ä½œè€…: <span class="author">å¼ ç¬”å¼ˆ</span></div>
            </div>
            <button onclick="showProjectInfo()">é¡¹ç›®ä¿¡æ¯</button>
        </div>
        
        <!-- å†…å®¹åŒºåŸŸ -->
        <div class="content">
            <!-- å·¦ä¾§ï¼šåœ°å›¾å’Œæ§åˆ¶é¢æ¿ -->
            <div class="left-panel">
                <!-- åœ°å›¾å®¹å™¨ -->
                <div class="map-container">
                    <div id="map"></div>
                </div>
                
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="controls">
                    <h3>ğŸ“Š åˆ†ææ§åˆ¶</h3>
                    
                    <div class="control-group">
                        <label for="layer-select">é€‰æ‹©å¯è§†åŒ–å›¾å±‚:</label>
                        <select id="layer-select" onchange="changeLayer()">
                            <option value="zones">åŠŸèƒ½åŒºåˆ†å¸ƒ</option>
                            <option value="poi-density">POIå¯†åº¦çƒ­åŠ›å›¾</option>
                            <option value="ndvi">æ¤è¢«æŒ‡æ•°(NDVI)</option>
                            <option value="roads">è·¯ç½‘åˆ†å¸ƒ</option>
                            <option value="vitality">åŸå¸‚æ´»åŠ›æŒ‡æ•°</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="year-select">æ—¶é—´èŒƒå›´:</label>
                        <select id="year-select">
                            <option value="2023">2023å¹´</option>
                            <option value="2022">2022å¹´</option>
                            <option value="2021">2021å¹´</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="zone-filter">åŠŸèƒ½åŒºç±»å‹ç­›é€‰:</label>
                        <select id="zone-filter" multiple onchange="filterZones()">
                            <option value="commercial" selected>å•†ä¸šåŒº</option>
                            <option value="residential" selected>å±…ä½åŒº</option>
                            <option value="office" selected>åŠå…¬åŒº</option>
                            <option value="education" selected>æ–‡æ•™åŒº</option>
                            <option value="green" selected>ç»¿åœ°/å…¬å›­</option>
                            <option value="medical" selected>åŒ»ç–—åŒº</option>
                            <option value="mixed" selected>æ··åˆåŠŸèƒ½åŒº</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>åˆ†ææ“ä½œ:</label>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="analyzeChanges()">ğŸ” å˜åŒ–æ£€æµ‹</button>
                            <button onclick="predictTrend()">ğŸ“ˆ è¶‹åŠ¿é¢„æµ‹</button>
                            <button onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šç»Ÿè®¡å’Œå›¾å±‚ -->
            <div class="right-panel">
                <!-- ç»Ÿè®¡é¢æ¿ -->
                <div class="stats-panel">
                    <h3>ğŸ“ˆ åŒºåŸŸç»Ÿè®¡</h3>
                    <div id="stats-content">
                        <div class="stat-item">
                            <div class="stat-label">åˆ†æåŒºåŸŸ</div>
                            <div class="stat-value">å¹¿å·å¤©æ²³åŒº</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ç½‘æ ¼æ€»æ•°</div>
                            <div class="stat-value" id="total-grids">18</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">POIæ€»æ•°</div>
                            <div class="stat-value" id="total-poi">256</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å¹³å‡NDVI</div>
                            <div class="stat-value" id="avg-ndvi">0.35</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">è·¯ç½‘å¯†åº¦</div>
                            <div class="stat-value" id="road-density">0.012 km/kmÂ²</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">åŸå¸‚æ´»åŠ›æŒ‡æ•°</div>
                            <div class="stat-value" id="vitality-index">0.62</div>
                        </div>
                    </div>
                </div>
                
                <!-- å›¾ä¾‹é¢æ¿ -->
                <div class="legend-panel">
                    <h3>ğŸ¨ åŠŸèƒ½åŒºå›¾ä¾‹</h3>
                    <div id="legend-content">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FF6B6B;"></div>
                            <div class="legend-label">å•†ä¸šåŒº</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #4ECDC4;"></div>
                            <div class="legend-label">å±…ä½åŒº</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #45B7D1;"></div>
                            <div class="legend-label">åŠå…¬åŒº</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #96CEB4;"></div>
                            <div class="legend-label">æ–‡æ•™åŒº</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #FFEAA7;"></div>
                            <div class="legend-label">ç»¿åœ°/å…¬å›­</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #DDA0DD;"></div>
                            <div class="legend-label">åŒ»ç–—åŒº</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #98D8C8;"></div>
                            <div class="legend-label">æ··åˆåŠŸèƒ½åŒº</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨ -->
        <div class="footer">
            <p>åŸå¸‚åŠŸèƒ½åŒºåŠ¨æ€åˆ†æå¹³å° | æŠ€æœ¯æ”¯æŒ: GIS + é¥æ„Ÿ + å¤§æ•°æ® + AI | ç‰ˆæœ¬: 1.0.0 | Â© 2026 å¼ ç¬”å¼ˆ</p>
            <p>æœ¬ç³»ç»Ÿä¸ºDemoç‰ˆæœ¬ï¼Œæ•°æ®ä¸ºæ¨¡æ‹Ÿæ•°æ®ï¼Œä»…ç”¨äºæŠ€æœ¯æ¼”ç¤º</p>
        </div>
    </div>
    
    <!-- é¡¹ç›®ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">Ã—</span>
            <h3>ğŸ“‹ é¡¹ç›®ä¿¡æ¯</h3>
            <div style="line-height: 1.6;">
                <p><strong>é¡¹ç›®åç§°:</strong> åŸºäºå¤šæºæ•°æ®èåˆçš„åŸå¸‚åŠŸèƒ½åŒºåŠ¨æ€åˆ†æä¸å¯è§†åŒ–å¹³å°</p>
                <p><strong>é¡¹ç›®ç›®æ ‡:</strong> æ„å»ºä¸€ä¸ªé›†æˆGISã€é¥æ„Ÿã€POIã€äº¤é€šæµç­‰å¤šæºæ•°æ®çš„åŠ¨æ€åˆ†æå¹³å°ï¼Œå®ç°åŠŸèƒ½åŒºæ™ºèƒ½è¯†åˆ«ã€å˜åŒ–ç›‘æµ‹ä¸å¯è§†åŒ–å±•ç¤ºã€‚</p>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">ğŸ¯ æ ¸å¿ƒåŠŸèƒ½</h4>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>å¤šæºæ•°æ®èåˆä¸å¤„ç†</li>
                    <li>åŠŸèƒ½åŒºæ™ºèƒ½è¯†åˆ«ä¸åˆ†ç±»</li>
                    <li>æ—¶åºå˜åŒ–æ£€æµ‹ä¸åˆ†æ</li>
                    <li>äº¤äº’å¼å¯è§†åŒ–å±•ç¤º</li>
                    <li>è¶‹åŠ¿é¢„æµ‹ä¸å‘å±•å»ºè®®</li>
                </ul>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">ğŸ› ï¸ æŠ€æœ¯æ ˆ</h4>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li><strong>åç«¯:</strong> Python, GeoPandas, Scikit-learn</li>
                    <li><strong>å‰ç«¯:</strong> JavaScript, Leaflet, HTML/CSS</li>
                    <li><strong>æ•°æ®:</strong> GIS, é¥æ„Ÿå½±åƒ, POI, è·¯ç½‘æ•°æ®</li>
                    <li><strong>å¯è§†åŒ–:</strong> Folium, Plotly, Tableau</li>
                </ul>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">ğŸ“Š åº”ç”¨ä»·å€¼</h4>
                <ul style="margin-left: 20px;">
                    <li>ä¸ºåŸå¸‚è§„åˆ’æä¾›æ•°æ®æ”¯æŒ</li>
                    <li>è¾…åŠ©å•†ä¸šé€‰å€ä¸æŠ•èµ„å†³ç­–</li>
                    <li>æ”¯æŒåŸå¸‚ç®¡ç†ä¸æ™ºæ…§åŸå¸‚å»ºè®¾</li>
                    <li>ä¿ƒè¿›è·¨å­¦ç§‘ç ”ç©¶ä¸å®è·µ</li>
                </ul>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <p><strong>ä½œè€…:</strong> å¼ ç¬”å¼ˆ | ä»²æºå†œä¸šå·¥ç¨‹å­¦é™¢ åœŸåœ°ç§‘å­¦ä¸æŠ€æœ¯(GISæ–¹å‘)</p>
                    <p><strong>è”ç³»æ–¹å¼:</strong> 3792458256@qq.com | ç”µè¯: 13670473813</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.js"></script>
    
    <script>
        // åˆå§‹åŒ–åœ°å›¾
        let map = L.map('map').setView([23.132, 113.332], 13);
        
        // æ·»åŠ åº•å›¾
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        // æ·»åŠ å…¨å±æ§ä»¶
        L.control.fullscreen().addTo(map);
        
        // æ¨¡æ‹ŸåŠŸèƒ½åŒºæ•°æ®
        const functionZones = [
            {
                id: "G_001_001",
                type: "commercial",
                name: "å•†ä¸šåŒº",
                lat: 23.132,
                lng: 113.332,
                poi_count: 25,
                ndvi: 0.18,
                road_density: 0.018,
                vitality: 0.85
            },
            {
                id: "G_001_002",
                type: "residential",
                name: "å±…ä½åŒº",
                lat: 23.134,
                lng: 113.334,
                poi_count: 12,
                ndvi: 0.35,
                road_density: 0.010,
                vitality: 0.52
            },
            {
                id: "G_001_003",
                type: "office",
                name: "åŠå…¬åŒº",
                lat: 23.130,
                lng: 113.330,
                poi_count: 18,
                ndvi: 0.22,
                road_density: 0.015,
                vitality: 0.68
            },
            {
                id: "G_001_004",
                type: "education",
                name: "æ–‡æ•™åŒº",
                lat: 23.128,
                lng: 113.328,
                poi_count: 8,
                ndvi: 0.45,
                road_density: 0.008,
                vitality: 0.42
            },
            {
                id: "G_001_005",
                type: "green",
                name: "ç»¿åœ°/å…¬å›­",
                lat: 23.126,
                lng: 113.326,
                poi_count: 3,
                ndvi: 0.70,
                road_density: 0.004,
                vitality: 0.25
            },
            {
                id: "G_001_006",
                type: "medical",
                name: "åŒ»ç–—åŒº",
                lat: 23.124,
                lng: 113.324,
                poi_count: 10,
                ndvi: 0.40,
                road_density: 0.009,
                vitality: 0.48
            },
            {
                id: "G_001_007",
                type: "mixed",
                name: "æ··åˆåŠŸèƒ½åŒº",
                lat: 23.122,
                lng: 113.322,
                poi_count: 15,
                ndvi: 0.30,
                road_density: 0.012,
                vitality: 0.58
            }
        ];
        
        // POIæ•°æ®
        const poiData = [
            {lat: 23.132, lng: 113.332, type: "è´­ç‰©", name: "å¤©æ²³åŸ"},
            {lat: 23.133, lng: 113.333, type: "è´­ç‰©", name: "æ­£ä½³å¹¿åœº"},
            {lat: 23.131, lng: 113.331, type: "é¤é¥®", name: "æµ·åº•æ"},
            {lat: 23.130, lng: 113.330, type: "åŠå…¬", name: "ä¸­ä¿¡å¹¿åœº"},
            {lat: 23.129, lng: 113.329, type: "æ•™è‚²", name: "ä¸­å±±å¤§å­¦"},
            {lat: 23.128, lng: 113.328, type: "åŒ»ç–—", name: "çœäººæ°‘åŒ»é™¢"},
            {lat: 23.127, lng: 113.327, type: "äº¤é€š", name: "å¹¿å·ä¸œç«™"}
        ];
        
        // é¢œè‰²æ˜ å°„
        const zoneColors = {
            commercial: "#FF6B6B",
            residential: "#4ECDC4",
            office: "#45B7D1",
            education: "#96CEB4",
            green: "#FFEAA7",
            medical: "#DDA0DD",
            mixed: "#98D8C8"
        };
        
        // å›¾å±‚ç»„
        let zonesLayer = L.layerGroup();
        let poiLayer = L.layerGroup();
        let heatmapLayer = L.layerGroup();
        let roadsLayer = L.layerGroup();
        
        // åˆå§‹åŒ–åŠŸèƒ½åŒºå›¾å±‚
        function initZonesLayer() {
            zonesLayer.clearLayers();
            
            const selectedZones = Array.from(document.getElementById('zone-filter').selectedOptions)
                .map(option => option.value);
            
            functionZones.forEach(zone => {
                if (selectedZones.includes(zone.type)) {
                    const marker = L.circleMarker([zone.lat, zone.lng], {
                        radius: 15,
                        fillColor: zoneColors[zone.type],
                        color: "#000",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.7
                    });
                    
                    marker.bindPopup(`
                        <div style="font-family: 'Microsoft YaHei', sans-serif; min-width: 200px;">
                            <h3 style="margin: 0 0 10px 0; color: #2c3e50;">${zone.name}</h3>
                            <p><strong>ç½‘æ ¼ID:</strong> ${zone.id}</p>
                            <p><strong>POIæ•°é‡:</strong> ${zone.poi_count}</p>
                            <p><strong>æ¤è¢«æŒ‡æ•°:</strong> ${zone.ndvi.toFixed(2)}</p>
                            <p><strong>è·¯ç½‘å¯†åº¦:</strong> ${zone.road_density.toFixed(3)}</p>
                            <p><strong>åŸå¸‚æ´»åŠ›:</strong> ${zone.vitality.toFixed(2)}</p>
                            <button onclick="analyzeZone('${zone.id}')" style="margin-top: 10px; padding: 5px 10px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">è¯¦ç»†åˆ†æ</button>
                        </div>
                    `);
                    
                    zonesLayer.addLayer(marker);
                }
            });
            
            zonesLayer.addTo(map);
        }
        
        // åˆå§‹åŒ–POIå›¾å±‚
        function initPoiLayer() {
            poiLayer.clearLayers();
            
            poiData.forEach(poi => {
                const marker = L.circleMarker([poi.lat, poi.lng], {
                    radius: 6,
                    fillColor: "#3498db",
                    color: "#fff",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Microsoft YaHei', sans-serif;">
                        <h4 style="margin: 0 0 5px 0;">${poi.name}</h4>
                        <p><strong>ç±»å‹:</strong> ${poi.type}</p>
                        <p><strong>ä½ç½®:</strong> ${poi.lat.toFixed(4)}, ${poi.lng.toFixed(4)}</p>
                    </div>
                `);
                
                poiLayer.addLayer(marker);
            });
        }
        
        // åˆ›å»ºçƒ­åŠ›å›¾æ•°æ®
        function createHeatmapData() {
            const heatData = [];
            functionZones.forEach(zone => {
                // æ ¹æ®POIæ•°é‡ç”Ÿæˆçƒ­åŠ›å›¾å¼ºåº¦
                const intensity = zone.poi_count / 25;
                for (let i = 0; i < 3; i++) {
                    // æ·»åŠ ä¸€äº›éšæœºç‚¹ä»¥åˆ›å»ºçƒ­åŠ›å›¾æ•ˆæœ
                    const lat = zone.lat + (Math.random() - 0.5) * 0.005;
                    const lng = zone.lng + (Math.random() - 0.5) * 0.005;
                    heatData.push([lat, lng, intensity]);
                }
            });
            return heatData;
        }
        
        // åˆå§‹åŒ–çƒ­åŠ›å›¾
        function initHeatmap() {
            heatmapLayer.clearLayers();
            
            // åˆ›å»ºçƒ­åŠ›å›¾
            const heatData = createHeatmapData();
            
            // åˆ›å»ºçƒ­åŠ›å›¾ï¼ˆä½¿ç”¨åœ†å½¢æ¨¡æ‹Ÿï¼‰
            heatData.forEach(point => {
                L.circleMarker([point[0], point[1]], {
                    radius: 10,
                    fillColor: "#ff7800",
                    color: "transparent",
                    fillOpacity: point[2] * 0.5
                }).addTo(heatmapLayer);
            });
        }
        
        // åˆå§‹åŒ–è·¯ç½‘
        function initRoads() {
            roadsLayer.clearLayers();
            
            // æ¨¡æ‹Ÿè·¯ç½‘æ•°æ®
            const roads = [
                {
                    name: "å¤©æ²³è·¯",
                    coordinates: [[23.132, 113.325], [23.132, 113.335]]
                },
                {
                    name: "ä½“è‚²è¥¿è·¯",
                    coordinates: [[23.125, 113.328], [23.135, 113.328]]
                },
                {
                    name: "ä¸­å±±å¤§é“",
                    coordinates: [[23.125, 113.310], [23.125, 113.330]]
                },
                {
                    name: "å¤©æ²³åŒ—è·¯",
                    coordinates: [[23.140, 113.315], [23.140, 113.330]]
                }
            ];
            
            roads.forEach(road => {
                const polyline = L.polyline(road.coordinates, {
                    color: "#34495e",
                    weight: 3,
                    opacity: 0.7
                });
                
                polyline.bindPopup(`<b>${road.name}</b><br>ä¸»è¦äº¤é€šå¹²é“`);
                roadsLayer.addLayer(polyline);
            });
        }
        
        // åˆ‡æ¢å›¾å±‚
        function changeLayer() {
            const layerType = document.getElementById('layer-select').value;
            
            // ç§»é™¤æ‰€æœ‰å›¾å±‚
            zonesLayer.remove();
            poiLayer.remove();
            heatmapLayer.remove();
            roadsLayer.remove();
            
            // æ ¹æ®é€‰æ‹©æ·»åŠ å›¾å±‚
            switch(layerType) {
                case 'zones':
                    initZonesLayer();
                    break;
                case 'poi-density':
                    initHeatmap();
                    heatmapLayer.addTo(map);
                    break;
                case 'ndvi':
                    // æ¨¡æ‹ŸNDVIå›¾å±‚
                    initZonesLayer();
                    // è¿™é‡Œå¯ä»¥æ·»åŠ NDVIç‰¹å®šçš„æ ·å¼
                    break;
                case 'roads':
                    initRoads();
                    roadsLayer.addTo(map);
                    break;
                case 'vitality':
                    initZonesLayer();
                    // è¿™é‡Œå¯ä»¥æ·»åŠ åŸå¸‚æ´»åŠ›ç‰¹å®šçš„æ ·å¼
                    break;
            }
        }
        
        // ç­›é€‰åŠŸèƒ½åŒº
        function filterZones() {
            changeLayer();
            updateStats();
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const selectedZones = Array.from(document.getElementById('zone-filter').selectedOptions)
                .map(option => option.value);
            
            const filteredZones = functionZones.filter(zone => selectedZones.includes(zone.type));
            
            if (filteredZones.length > 0) {
                const totalPoi = filteredZones.reduce((sum, zone) => sum + zone.poi_count, 0);
                const avgNdvi = filteredZones.reduce((sum, zone) => sum + zone.ndvi, 0) / filteredZones.length;
                const avgRoadDensity = filteredZones.reduce((sum, zone) => sum + zone.road_density, 0) / filteredZones.length;
                const avgVitality = filteredZones.reduce((sum, zone) => sum + zone.vitality, 0) / filteredZones.length;
                
                document.getElementById('total-grids').textContent = filteredZones.length;
                document.getElementById('total-poi').textContent = totalPoi;
                document.getElementById('avg-ndvi').textContent = avgNdvi.toFixed(2);
                document.getElementById('road-density').textContent = avgRoadDensity.toFixed(3) + " km/kmÂ²";
                document.getElementById('vitality-index').textContent = avgVitality.toFixed(2);
            }
        }
        
        // åˆ†æåŠŸèƒ½åŒºå˜åŒ–
        function analyzeChanges() {
            alert("ğŸ“Š å˜åŒ–æ£€æµ‹åˆ†æ\n\næ­£åœ¨åˆ†æ2022-2023å¹´çš„åŠŸèƒ½åŒºå˜åŒ–...\n\nä¸»è¦å‘ç°ï¼š\n1. å•†ä¸šåŒºæ‰©å±•äº†15%\n2. æ–°å¢åŠå…¬åŒºç½‘æ ¼3ä¸ª\n3. ç»¿åœ°é¢ç§¯å‡å°‘8%\n\nè¯¦ç»†æŠ¥å‘Šå·²ç”Ÿæˆï¼Œå¯åœ¨è¾“å‡ºç›®å½•æŸ¥çœ‹ã€‚");
            
            // æ¨¡æ‹Ÿå˜åŒ–æ£€æµ‹ç»“æœ
            const changeResults = [
                {zone: "å•†ä¸šåŒº", change: "+15%", trend: "æ‰©å¼ "},
                {zone: "åŠå…¬åŒº", change: "+10%", trend: "å¢é•¿"},
                {zone: "ç»¿åœ°/å…¬å›­", change: "-8%", trend: "å‡å°‘"},
                {zone: "å±…ä½åŒº", change: "+5%", trend: "ç¨³å®š"}
            ];
            
            // æ˜¾ç¤ºå˜åŒ–ç»“æœ
            let resultHtml = "<h4>ğŸ™ï¸ åŠŸèƒ½åŒºå˜åŒ–æ£€æµ‹ç»“æœ</h4><table style='width:100%; border-collapse: collapse; margin-top:10px;'>";
            resultHtml += "<tr style='background:#f8f9fa;'><th style='padding:8px; text-align:left;'>åŠŸèƒ½åŒº</th><th style='padding:8px; text-align:left;'>å˜åŒ–ç‡</th><th style='padding:8px; text-align:left;'>è¶‹åŠ¿</th></tr>";
            
            changeResults.forEach(result => {
                const color = result.change.startsWith("+") ? "#27ae60" : "#e74c3c";
                resultHtml += `<tr><td style='padding:8px; border-bottom:1px solid #eee;'>${result.zone}</td>`;
                resultHtml += `<td style='padding:8px; border-bottom:1px solid #eee; color:${color};'>${result.change}</td>`;
                resultHtml += `<td style='padding:8px; border-bottom:1px solid #eee;'>${result.trend}</td></tr>`;
            });
            
            resultHtml += "</table>";
            
            // åˆ›å»ºç»“æœçª—å£
            const resultWindow = window.open("", "åˆ†æç»“æœ", "width=600,height=400");
            resultWindow.document.write(`
                <html>
                <head>
                    <title>å˜åŒ–æ£€æµ‹ç»“æœ</title>
                    <style>
                        body { font-family: 'Microsoft YaHei', sans-serif; padding: 20px; }
                        h3 { color: #2c3e50; }
                        .summary { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0; }
                    </style>
                </head>
                <body>
                    <h3>ğŸ™ï¸ åŸå¸‚åŠŸèƒ½åŒºå˜åŒ–æ£€æµ‹æŠ¥å‘Š</h3>
                    <div class="summary">
                        <p><strong>åˆ†ææ—¶é—´:</strong> 2022å¹´ - 2023å¹´</p>
                        <p><strong>åˆ†æåŒºåŸŸ:</strong> å¹¿å·å¤©æ²³åŒº</p>
                        <p><strong>ä¸»è¦ç»“è®º:</strong> åŸå¸‚åŠŸèƒ½åŒºå‘ˆç°æ˜æ˜¾çš„å•†ä¸šåŒ–å’ŒåŠå…¬åŒ–è¶‹åŠ¿ï¼Œç»¿åœ°é¢ç§¯æœ‰æ‰€å‡å°‘ã€‚</p>
                    </div>
                    ${resultHtml}
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                        <button onclick="window.print()" style="padding: 8px 15px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">æ‰“å°æŠ¥å‘Š</button>
                        <button onclick="window.close()" style="padding: 8px 15px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">å…³é—­</button>
                    </div>
                </body>
                </html>
            `);
        }
        
        // è¶‹åŠ¿é¢„æµ‹
        function predictTrend() {
            alert("ğŸ“ˆ è¶‹åŠ¿é¢„æµ‹åˆ†æ\n\næ­£åœ¨åŸºäºå†å²æ•°æ®é¢„æµ‹æœªæ¥å‘å±•è¶‹åŠ¿...\n\né¢„æµ‹ç»“æœï¼š\n1. æœªæ¥3å¹´å•†ä¸šåŒºå°†ç»§ç»­æ‰©å¼ 20%\n2. åŠå…¬éœ€æ±‚å¢é•¿é¢„æœŸ15%\n3. å»ºè®®åŠ å¼ºç»¿åœ°ä¿æŠ¤ä¸å»ºè®¾\n\nè¯¦ç»†é¢„æµ‹æŠ¥å‘Šå·²ç”Ÿæˆã€‚");
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            alert("ğŸ“¥ æ•°æ®å¯¼å‡º\n\næ­£åœ¨å¯¼å‡ºå½“å‰åˆ†ææ•°æ®...\n\nå·²ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š\n1. function_zones_2023.geojson\n2. analysis_report_2023.pdf\n3. statistics_data.csv\n\næ–‡ä»¶å·²ä¿å­˜åˆ° outputs/ ç›®å½•ã€‚");
        }
        
        // åˆ†æå•ä¸ªåŠŸèƒ½åŒº
        function analyzeZone(zoneId) {
            const zone = functionZones.find(z => z.id === zoneId);
            if (zone) {
                alert(`ğŸ” è¯¦ç»†åˆ†æ: ${zone.name}\n\nç½‘æ ¼ID: ${zone.id}\nPOIå¯†åº¦: ${zone.poi_count}/kmÂ²\næ¤è¢«æŒ‡æ•°: ${zone.ndvi}\nè·¯ç½‘å¯†åº¦: ${zone.road_density}\nåŸå¸‚æ´»åŠ›: ${zone.vitality}\n\nå‘å±•å»ºè®®: ${getZoneRecommendation(zone.type)}`);
            }
        }
        
        // è·å–åŠŸèƒ½åŒºå»ºè®®
        function getZoneRecommendation(zoneType) {
            const recommendations = {
                commercial: "å»ºè®®åŠ å¼ºå•†ä¸šè®¾æ–½é…å¥—ï¼Œæå‡å•†ä¸šæ´»åŠ›",
                residential: "å»ºè®®å®Œå–„ç”Ÿæ´»æœåŠ¡è®¾æ–½ï¼Œæå‡å±…ä½å“è´¨",
                office: "å»ºè®®ä¼˜åŒ–åŠå…¬ç¯å¢ƒï¼Œå¢åŠ é…å¥—è®¾æ–½",
                education: "å»ºè®®ä¼˜åŒ–æ•™è‚²èµ„æºé…ç½®ï¼Œæå‡æ–‡åŒ–æ°›å›´",
                green: "å»ºè®®åŠ å¼ºç”Ÿæ€ä¿æŠ¤ï¼Œæå‡ç»¿åœ°è´¨é‡",
                medical: "å»ºè®®å®Œå–„åŒ»ç–—è®¾æ–½ï¼Œæå‡æœåŠ¡è´¨é‡",
                mixed: "å»ºè®®ä¼˜åŒ–åŠŸèƒ½å¸ƒå±€ï¼Œæå‡ç»¼åˆæ•ˆç›Š"
            };
            return recommendations[zoneType] || "å»ºè®®åŠ å¼ºè§„åˆ’ç®¡ç†";
        }
        
        // æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯æ¨¡æ€æ¡†
        function showProjectInfo() {
            document.getElementById('projectModal').style.display = 'flex';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('projectModal').style.display = 'none';
        }
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('projectModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾å±‚
            initZonesLayer();
            initPoiLayer();
            initHeatmap();
            initRoads();
            
            // é»˜è®¤æ˜¾ç¤ºåŠŸèƒ½åŒºå›¾å±‚
            zonesLayer.addTo(map);
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStats();
            
            // æ·»åŠ ä¸€äº›æ¨¡æ‹Ÿçš„POIæ ‡è®°
            poiData.forEach(poi => {
                L.circleMarker([poi.lat, poi.lng], {
                    radius: 4,
                    fillColor: "#3498db",
                    color: "#fff",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map).bindPopup(`<b>${poi.name}</b><br>${poi.type}`);
            });
            
            // æ·»åŠ æ¨¡æ‹Ÿçš„é“è·¯
            const road = L.polyline([
                [23.132, 113.325],
                [23.132, 113.332],
                [23.132, 113.338]
            ], {
                color: '#34495e',
                weight: 3,
                opacity: 0.7
            }).addTo(map).bindPopup("<b>å¤©æ²³è·¯</b><br>ä¸»è¦å•†ä¸šè¡—é“");
            
            console.log("ğŸš€ åŸå¸‚åŠŸèƒ½åŒºåˆ†æå¹³å°å·²å¯åŠ¨ï¼");
            console.log("ä½œè€…: å¼ ç¬”å¼ˆ | è”ç³»æ–¹å¼: 3792458256@qq.com");
        });
    </script>
</body>
</html>